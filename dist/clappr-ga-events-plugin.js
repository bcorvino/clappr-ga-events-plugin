!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Clappr")):"function"==typeof define&&define.amd?define(["Clappr"],t):"object"==typeof exports?exports.ClapprGaEventsPlugin=t(require("Clappr")):e.ClapprGaEventsPlugin=t(e.Clappr)}(this,function(e){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=n(2),l=n(1),c=i(l),u=function(e){function t(e){a(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._volumeTimer=null,n._doSendPlay=!0,n.readPluginConfig(n.options.gaEventsPlugin),(0,c["default"])(n._gaCfg.name,n._gaCfg.debug,n._gaCfg.trace),n._ga("create",n._trackingId,n._createFieldsObject),n}return o(t,e),r(t,[{key:"name",get:function(){return"ga_events"}}]),r(t,[{key:"bindEvents",value:function(){var e=this;this.listenTo(this.core.mediaControl,h.Events.MEDIACONTROL_CONTAINERCHANGED,this.containerChanged),this._container=this.core.getCurrentContainer(),this._container&&(this._label||(this._label=this._container.options.src),this.listenTo(this._container,h.Events.CONTAINER_TIMEUPDATE,this.onTimeUpdate),this.listenTo(this._container,h.Events.CONTAINER_PLAY,this.onPlay),this.listenTo(this._container,h.Events.CONTAINER_SEEK,function(t){return e.onSeek(t)}),this.listenTo(this._container,h.Events.CONTAINER_PAUSE,this.onPause),this.listenTo(this._container,h.Events.CONTAINER_STOP,this.onStop),this.listenTo(this._container,h.Events.CONTAINER_ENDED,this.onEnded),this._hasEvent("ready")&&this.listenTo(this._container,h.Events.CONTAINER_READY,this.onReady),this._hasEvent("buffering")&&this.listenTo(this._container,h.Events.CONTAINER_STATE_BUFFERING,this.onBuffering),this._hasEvent("bufferfull")&&this.listenTo(this._container,h.Events.CONTAINER_STATE_BUFFERFULL,this.onBufferFull),this._hasEvent("loadedmetadata")&&this.listenTo(this._container,h.Events.CONTAINER_LOADEDMETADATA,this.onLoadedMetadata),this._hasEvent("volume")&&this.listenTo(this._container,h.Events.CONTAINER_VOLUME,function(t){return e.onVolumeChanged(t)}),this._hasEvent("fullscreen")&&this.listenTo(this._container,h.Events.CONTAINER_FULL_SCREEN,this.onFullscreen),this._hasEvent("playbackstate")&&this.listenTo(this._container,h.Events.CONTAINER_PLAYBACKSTATE,this.onPlaybackChanged),this._hasEvent("highdefinitionupdate")&&this.listenTo(this._container,h.Events.CONTAINER_HIGHDEFINITIONUPDATE,this.onHD),this._hasEvent("playbackdvrstatechanged")&&this.listenTo(this._container,h.Events.CONTAINER_PLAYBACKDVRSTATECHANGED,this.onDVR),this._hasEvent("error")&&this.listenTo(this._container,h.Events.CONTAINER_ERROR,this.onError))}},{key:"getExternalInterface",value:function(){return this._trackerName?{gaEventsTracker:this.gaTracker}:{}}},{key:"containerChanged",value:function(){this.stopListening(),this.bindEvents()}},{key:"gaTracker",value:function(){return this._ga.getByName&&this._ga.getByName(this._trackerName)}},{key:"gaEvent",value:function(e,t,n,i){this._ga(this._send,"event",e,t,n,i)}},{key:"gaException",value:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];this._ga(this._send,"exception",{exDescription:e,exFatal:t})}},{key:"readPluginConfig",value:function(e){if(!e)throw new Error(this.name+" plugin config is missing");if(!e.trackingId)throw new Error(this.name+' plugin "trackingId" required config parameter is missing');this._gaCfg=e.gaCfg||{name:"ga",debug:!1,trace:!1},this._trackingId=e.trackingId,this._createFieldsObject=e.createFieldsObject,this._trackerName=this._createFieldsObject&&this._createFieldsObject.name,this._send=this._trackerName?this._trackerName+".send":"send",this._category=e.eventCategory||"Video",this._label=e.eventLabel,this._setValue=e.eventValueAuto===!0,this._events=h.$.isArray(e.eventToTrack)&&e.eventToTrack||this._defaultEvents,this._eventMap=h.$.isPlainObject(e.eventMapping)&&e.eventMapping||this._defaultEventMap,this._gaPlayOnce=e.sendPlayOnce===!0,this._gaEx=e.sendExceptions===!0,this._gaExDesc=e.sendExceptionsMsg===!0,this._gaEx&&!this._hasEvent("error")&&this._events.push("error")}},{key:"_hasEvent",value:function(e){return this._events.indexOf(e)!==-1}},{key:"_action",value:function(e){return this._eventMap[e]}},{key:"_value",value:function(e){if(this._setValue)return e}},{key:"trunc",value:function(e){return parseInt(e,10)}},{key:"onTimeUpdate",value:function(e){this._position=e.current&&this.trunc(e.current)||0}},{key:"onReady",value:function(){this.gaEvent(this._category,this._action("ready"),this._label)}},{key:"onBuffering",value:function(){this.gaEvent(this._category,this._action("buffering"),this._label)}},{key:"onBufferFull",value:function(){this.gaEvent(this._category,this._action("bufferfull"),this._label)}},{key:"onLoadedMetadata",value:function(e){this.gaEvent(this._category,this._action("loadedmetadata"),this._label)}},{key:"onPlay",value:function(){if(this._gaPlayOnce){if(!this._doSendPlay)return;this._doSendPlay=!1}this.gaEvent(this._category,this._action("play"),this._label,this._value(this.position))}},{key:"onSeek",value:function(e){this._hasEvent("seek")&&this.gaEvent(this._category,this._action("seek"),this._label,this._value(this.trunc(e))),this._gaPlayOnce&&(this._doSendPlay=!0)}},{key:"onPause",value:function(){this._hasEvent("pause")&&this.gaEvent(this._category,this._action("pause"),this._label,this._value(this.position)),this._gaPlayOnce&&(this._doSendPlay=!0)}},{key:"onStop",value:function(){this._hasEvent("stop")&&this.gaEvent(this._category,this._action("stop"),this._label,this._value(this.position)),this._gaPlayOnce&&(this._doSendPlay=!0)}},{key:"onEnded",value:function(){this._hasEvent("ended")&&this.gaEvent(this._category,this._action("ended"),this._label,this._value(this.position)),this._gaPlayOnce&&(this._doSendPlay=!0)}},{key:"onVolumeChanged",value:function(e){var t=this;clearTimeout(this._volumeTimer),this._volumeTimer=setTimeout(function(){t.gaEvent(t._category,t._action("volume"),t._label,t._value(t.trunc(e)))},400)}},{key:"onFullscreen",value:function(){this.gaEvent(this._category,this._action("fullscreen"),this._label)}},{key:"onPlaybackChanged",value:function(e){this.gaEvent(this._category,this._action("playbackstate"),this._label)}},{key:"onHD",value:function(e){this.gaEvent(this._category,this._action("highdefinitionupdate"),this._label)}},{key:"onDVR",value:function(e){this.gaEvent(this._category,this._action("playbackdvrstatechanged"),this._label)}},{key:"resolveErrMsg",value:function(e){if(!this._gaExDesc)return"error";var t=void 0;return t="string"==typeof e.error?e.error:h.$.isPlainObject(e.error)&&e.error.message?e.error.message:"Error: "+e.error}},{key:"onError",value:function(e){this._gaEx?this.gaException(this.resolveErrMsg(e),!0):this.gaEvent(this._category,this._action("error"),this._label)}},{key:"_ga",get:function(){return window[window.GoogleAnalyticsObject]}},{key:"_defaultEventMap",get:function(){return{ready:"ready",buffering:"buffering",bufferfull:"bufferfull",loadedmetadata:"loadedmetadata",play:"play",seek:"seek",pause:"pause",stop:"stop",ended:"ended",volume:"volume",fullscreen:"fullscreen",error:"error",playbackstate:"playbackstate",highdefinitionupdate:"highdefinitionupdate",playbackdvrstatechanged:"playbackdvrstatechanged"}}},{key:"_defaultEvents",get:function(){return["play","seek","pause","stop","ended","volume"]}},{key:"position",get:function(){return this.isLive?0:this._position}},{key:"isLive",get:function(){return this._container.getPlaybackType()===h.Playback.LIVE}},{key:"isPlaying",get:function(){return this._container.isPlaying()}}]),t}(h.CorePlugin);t["default"]=u,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e=arguments.length<=0||void 0===arguments[0]?"ga":arguments[0],t=arguments[1],n=arguments[2],i=window,a=document,s="script";if(!i[e]){n&&(i.ga_debug={trace:!0}),i.GoogleAnalyticsObject=e,i[e]=function(){i[e].q.push(arguments)},i[e].q=[],i[e].l=1*new Date;var o=a.getElementsByTagName(s)[0],r=a.createElement(s);r.src="https://www.google-analytics.com/analytics"+(t?"_debug.js":".js"),r.async=!0,o.parentNode.insertBefore(r,o)}},e.exports=t["default"]},function(t,n){t.exports=e}])});